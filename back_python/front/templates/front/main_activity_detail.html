<div class="container page" id="activity_detail" data-page-root="activity_detail"  ms-controller="activity_detail">　
    <nav class="navbar navbar-default  navbar-fixed-top">
      <div  class="row navButton">
          <div  class="col-xs-4 text-left icon">
            <a  href="#!/main/activity">
              <i class="glyphicon glyphicon-arrow-left fa-lg active"></i>
            </a>
          </div>
          <div class="col-xs-4 text-center">
              <h4 id="title" class="topNavButton">{? @title ?}</h4>
          </div>
          <div class="col-xs-4 text-right">
            <!-- <a>
              <i class="fa fa-cart-plus fa-2x"></i>
            </a> -->
          </div>
      </div>
    </nav>
    <div class="container-fluid">
      <div class="row">
          <div class="col-sm-12" ms-if="@isDetail">
            <div class="thumbnail noborder" ms-if="@item">
              <img class="media-object" ms-attr="{src:@item.img}" alt="...">
              <div class="caption">
                <h3>{? @item.name ?}</h3>
                <p class="text-right">
                  <button  class="btn button-highlight" role="button" ms-click="@digClick">您的孩子适合选择什么习惯呢？</button>
                </p>
                <p>活动类别：{? @item.cat ?}</p>
                <p>关键词:{? @item.desc ?}</p>
                <p>起止日期：{? @item.startTime ?}——{? @item.endTime ?}</p>
                <p>
                  <div ms-html="@item.memo">
                  </div>
                </p>

              </div>
            </div>
          </div>
          <div class="col-sm-12" ms-if="@isDiagnose">
            <div class="thumbnail noborder">
              <div class="caption">
                <h4><span class="warncolor"><i class="fa fa-question fa-lg"></i><span>正在了解您的孩子，请回答问题</h4>
                <h3>{? @curQuestion.name ?}</h3><br/>
                <div class="btn-group" data-toggle="buttons">
                    <label class="btn btn-default">
                      <input type="radio" name="options" value="L"  id="option1" autocomplete="off"/> 较差
                    </label>
                    <label class="btn btn-default active">
                      <input type="radio" name="options" value="M" ms-duplex="@curQuestion.level" id="option2" autocomplete="off" checked/> 一般
                    </label>
                    <label class="btn btn-default">
                      <input type="radio" name="options" value="H" id="option3" autocomplete="off"/> 良好
                    </label>
                </div>
              </div>
            </div>
            <p class="text-right" ms-if="@item['habitCat'].length">
              <button  class="btn button-highlight" role="button" ms-click="@nextClick">下一个</button>
            </p>
            <p class="text-right" ms-if="@item['habitCat'].length==0">
              <button  class="btn button-highlight" role="button" ms-click="@digOk">确认报名</button>
            </p>
          </div>
          <div class="col-sm-12" ms-if="@rptOk">
            <div class="thumbnail noborder">
              <div class="caption">
                <h4><span class="warncolor"><i class="fa fa-question fa-lg"></i><span>报名成功</h4>
                <h5>按照您的答题，为您的孩子匹配了如下习惯</h5>
                <p>
                    <span>习惯１</span>
                    <span>习惯２</span>
                </p>
              </div>
            </div>
            <div class="well">
               <h5>懒人基金分享</h5>
               <p>存入懒人基金，每天打卡赢回基金</p>
               <p>活动持续时间：３０天</p>
               <p>每天打卡：返还１元</p>
               <p>活动结束：所有参与者均分剩余基金</p>
               <p>目前已经有几人参与，基金</p>
            </div>
            <p class="text-right">
              <button  class="btn button-highlight" role="button" ms-click="@nextClick">点击参与</button>
            </p>
          </div>
       </div>
    </div>
  </div>
  <script>
  $yml.page=$yml.pageBase.New(null,{
    ctor:function(){
      console.log("addChild loaded..."+this.getVmEleName());
      //基类里在pageReady方法里和可以访问成员$vmPage和$router
      //this.$vmPage
      //this.$router
    },
    vmDef:function(){
      var self=this;
      return {
        $id:"activity_detail",
        item:false,
        curQuestion:false,
        toSubmit:[],
        isDiagnose:false,
        isDetail:true,
        rptOk:false,//已经成功报名，考虑在后台利用缓存
        title:"报名",
        digClick:function(){
          this.isDiagnose=true;
          this.isDetail=false;
          this.title="答题";
          //this.rptOk=false;
        },
        cleanUp:function(){
          console.log("clean up...")
          this.isDiagnose=false;
          this.rptOk=false;
          this.isDetail=true;
          this.title="报名";
        },
        nextClick:function(){
          var initFirstQuestion=$yml.page.$vmPage.item["habitCat"].pop();
          $yml.page.$vmPage.curQuestion=initFirstQuestion;
          $yml.page.$vmPage.toSubmit.push(initFirstQuestion)
        },
        digOk:function(){
          this.isDiagnose=false;
          this.isDetail=false;
          this.rptOk=true;
          this.title="报名完成";
          console.log(this.toSubmit[0].level
          console.log(this.toSubmit[1].level)
        }
      };
    },
    pageReady:function(paramObj){
      var self=this;
      console.log("pageReady");
      console.log(paramObj);
      $yml.ajax('/api/activity/detail',paramObj,
      　  function(res){
            $yml.page.$vmPage.item=res.content.data;
            var initFirstQuestion=$yml.page.$vmPage.item["habitCat"].pop();
            $yml.page.$vmPage.curQuestion=initFirstQuestion;
            $yml.page.$vmPage.toSubmit.push(initFirstQuestion)
          }
      );
    }
  });
  </script>
